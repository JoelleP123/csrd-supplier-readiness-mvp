# Cell - Tag Logic for Intake form

# --- Section A ---

    # 1. EU-linked buyers may request more information
    if intake.get("operates_in_eu") in {"Both", "EU"}:
        tags.append("CSRD_CASCADE_SIGNAL")
    #  Expectation 1: Assumption for both: EU-linked buyers may request information due to reporting/risk expectations.

    # 2. Seller is not sure about selling to EU buyers -> opacity + confidence risk
    if intake.get("sells_to_eu_buyers") == "Not sure":
        tags.append("BUYER_OPACITY_RISK")
        tags.append("SUPPLIER_CONFIDENCE_LOW")
        #Expectation 2: Supplier is not sure about selling to EU buyers

    # 3. Large company with EU or mixed operations -> CSRD pressure signal
    if (intake.get("company_size") == "Large"
            and intake.get("operates_in_eu") in {"Both", "EU"}):
        tags.append("CSRD_CASCADE_SIGNAL")
## Expectation 3 (non-EU + EU exposure): EU-linked buyers may request more information from larger suppliers  to meet evolving sustainability reporting and risk expectations.

 # 4. Sector-based logic placeholder (unimplemented)
    # if intake.get("sector") == "Some sector":
    #     tags.append("...")

    # 5. Dual role pressure if the supplier has both supplier and buyer roles
    if intake.get("value_chain_role") == "Both a supplier and a buyer":
        tags.append("DUAL_ROLE_PRESSURE")


    # --- Section B ---

    # 6. Supply chain complexity signals multi-tier pressure/opacities
    complexity = intake.get("supply_chain_complexity")
    if complexity == "Mix of direct and indirect":
        tags.append("DUAL_ROLE_PRESSURE")
    if complexity == "Highly multi-tiered":
        tags.append("BUYER_OPACITY_RISK")
        tags.append("HRDD_RELEVANCE_HIGH")

    # 7. High risk sourcing areas drive HRDD relevance and opacity risks
    if intake.get("hr_risk_region") in {"Yes", "Some operations", "Not sure"}: # Corrected key
        tags.append("HRDD_RELEVANCE_HIGH")
        tags.append("BUYER_OPACITY_RISK")

    # 8. Labor issues materiality drives HRDD relevance
    if intake.get("labor_material") in {"Yes", "Somewhat"}: # Corrected key and comparison
        tags.append("HRDD_RELEVANCE_HIGH")


    # --- Section C ---

    # 9. No environmental requests -> documentation light
    if intake.get("env_asked") == "No": # Corrected key
        tags.append("DOCUMENTATION_LIGHT")
    if intake.get("env_asked") == "yes":
      print("Information requests often increase when buyers update internal policies, respond to investor expectations, or adapt to changing EU sustainability requirements. Suppliers are frequently not given clear explanations—so uncertainty itself becomes a risk factor.")
## to add in later as a note in the intake:
## Use whenever buyer pressure = Yes or Expected soon:
## WHY YOU’RE BEING ASKED:
## These requests often increase when buyers update internal policies, respond to investor expectations, or adapt to changing EU sustainability requirements. Suppliers are frequently not given clear explanations—so uncertainty itself becomes a risk factor.

# 10. Unspecified environmental topics -> opacity risk
    if intake.get("env_topics") in {"Not specified / unclear", "Not Specified/Unclear"}: # Corrected key
        tags.append("BUYER_OPACITY_RISK")
# if intake.get("which_topic_environment") ==

 # 11. No recent info request -> governance gap
    if intake.get("recent_esg_requests") == "No": # Corrected key
        tags.append("OWNER_GAP")
## to add in later as a note for the intake:
## Use whenever buyer pressure = Yes or Expected soon:
## WHY YOU’RE BEING ASKED:
## These requests often increase when buyers update internal policies, respond to investor expectations, or adapt to changing EU sustainability requirements. Suppliers are frequently not given clear explanations—so uncertainty itself becomes a risk factor.

# 12. More detailed requests lower supplier confidence
    if intake.get("more_detailed_requests") in {
        "Yes, significantly more detailed", "Yes, somewhat more detailed"
    }: # Corrected key
        tags.append("SUPPLIER_CONFIDENCE_LOW")
## TBD check later = if intake.get("info_request_more_detailed") == "Yes, more detailed" or "Yes, somewhat more detailed":
## TBD check later = tags.append("CSRD_CASCADE_SIGNAL")

# 13. Reason for requests: CSRD vs unclear explanations
    prompt = intake.get("request_driver") # Corrected key
    if prompt == "CSRD regulations": # Corrected string value
        tags.append("CSRD_CASCADE_SIGNAL")
    if prompt == "Unclear / not explained": # Corrected string value
        tags.append("BUYER_OPACITY_RISK")
        tags.append("SUPPLIER_CONFIDENCE_LOW")
## “Assume that suppliers may be receiving requests influenced by regulatory changes even when legal obligations do not formally apply to them.”

# 14. CSRD mentioned or not
    csrd_req = intake.get("csrd_mentioned") # Corrected key
    if csrd_req in {"Yes, explicitly", "Yes, indirectly (e.g. “new EU requirements”)", "Yes, indirectly"}:
        tags.append("CSRD_CASCADE_SIGNAL")
    if csrd_req == "Not sure":
        tags.append("SUPPLIER_CONFIDENCE_LOW")

    # --- Section D ---

    # 15. Owner gaps drive low confidence
    owner_status = intake.get("internal_owner") # Correct key
    if owner_status == "No clear owner":
        tags.append("SUPPLIER_CONFIDENCE_LOW")
    if owner_status in {"Shared responsibility", "Legal / compliance only", "No clear owner"}: # Corrected set
        tags.append("SUPPLIER_CONFIDENCE_LOW")

# 16. Policy status
    policy_status = intake.get("policy_status") # Corrected key
    if policy_status == "Draft / informal":
        tags.append("HRDD_RELEVANCE_HIGH")
    if policy_status in {"Draft / informal", "No"}: # Corrected set
        tags.append("DOCUMENTATION_LIGHT")
    if policy_status == "No":
        tags.append("ENVIRONMENTAL_BASELINE_GAP")
        tags.append("OWNER_GAP")
## Note: to ammend logic of question later:
## No, if other questions are flagged: HRDD_RELEVANCE_HIGH

# 17. Data tracking
    data_status = intake.get("data_tracking") # Correct key
    if data_status in {"No", "Informal / ad hoc"}: # Corrected set
        tags.append("ENVIRONMENTAL_BASELINE_GAP")
    if data_status == "No":
        tags.append("OWNER_GAP")
        tags.append("DOCUMENTATION_LIGHT")

 # 18. Confidence level
    if intake.get("confidence") == "Not confident": # Corrected key
        tags.append("OWNER_GAP") # Changed from GOVERNANCE_OWNER_GAP to OWNER_GAP

    # Example rule for future use:
    # if intake.get("has_written_policies") == "No" and intake.get("tracks_sustainability_data") == "No":
    #     tags.append("ENVIRONMENTAL_BASELINE_GAP")
    return tags


# Example usage:
# normalized_intake = {
#     "operates_in_eu": "EU",
#     "sells_to_eu_buyers": "Yes, directly",
#     "company_size": "Large",
#     "value_chain_role": "Both a supplier and a buyer",
#     "supply_chain_complexity": "Highly multi-tiered",
#     "hr_risk_region": "Yes",
#     "labor_material": "Yes",
#     "env_asked": "No",
#     "env_topics": "Not specified / unclear",
#     "recent_esg_requests": "No",
#     "more_detailed_requests": "Yes, significantly more detailed",
#     "request_driver": "CSRD regulations",
#     "csrd_mentioned": "Yes, explicitly",
#     "internal_owner": "No clear owner",
#     "policy_status": "No",
#     "data_tracking": "No",
#     "confidence": "Not confident",
# }
# tags = derive_tags(normalized_intake)
# for tag in tags:
#     print(f"{tag}: {TAG_DEFS.get(tag, '(no definition)')}")


# --- Run tag derivation ---
applied_tags = derive_tags(a)


for t in applied_tags:
    print(f"{t}") # Removed TAG_DEFS.get to avoid NameError for now

print("\nApplied tags list:", applied_tags)



